<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zaploop Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <!-- favicon https://upload.wikimedia.org/wikipedia/commons/thumb/6/67/Google_Messages_icon_%282022%29.svg/192px-Google_Messages_icon_%282022%29.svg.png-->
    <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/6/67/Google_Messages_icon_%282022%29.svg/192px-Google_Messages_icon_%282022%29.svg.png" type="image/png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/regular/style.css">
</head>
<body>
<!-- add header, full width -->
<header class="header" style="width: 100%;">
    <h1>Zaploop Dashboard</h1>
    <div class="header-controls">
        <input type="text" id="globalSessionId" placeholder="Enter Session ID" value="default">
        <button id="updateServerBtn" onclick="updateServer()" class="update-btn">
            <i class="ph ph-arrow-circle-up"></i> Update Server
        </button>
    </div>
</header>
<button onclick="new Notyf().success('This is a success notification!');">Test Alert</button>


    <div class="container" style="margin-top: 90px;">
        
        <div class="section">
            <h2><i class="ph ph-plus-circle"></i> Create New Session</h2>
            <div class="form-group">
                <input type="text" id="sessionId" value="default" placeholder="Enter Session ID">
                <button onclick="createSession()">Generate QR Code</button>
            </div>
            <!-- Update QR code container with proper structure -->
            <div class="qr-container">
                <div id="qrcode-placeholder" class="qr-placeholder">
                    Waiting for QR code...
                    <div class="spinner"></div>
                </div>
                <img id="qr-image" class="qr-image" style="display: none;" alt="QR Code" />
                <div id="qr-status" class="qr-status"></div>
            </div>
        </div>

        <div class="section">
            <h2><i class="ph ph-broadcast"></i> Online Sessions</h2>
            <div id="sessionsList">
                <!-- Sessions will be populated here -->
            </div>
            <div id="sessionListPlaceholder">
                <p>No active sessions</p>
            </div>
            <span hoverable id="refresh-sessions" class="" onclick="refreshSessions()" style="cursor: pointer;">
                <i class="ph ph-arrows-clockwise"></i> Get Sessions
            </span>
        </div>

        <!-- Add this after your existing sessions section but before the closing body tag -->
<div class="section">
    <h2><i class="ph ph-chats"></i> Session Details</h2>
    <div class="session-details">
        <!-- Session selector -->
        <div class="select-wrapper">
            <select id="detailsSessionSelect" class="select-input">
                <option value="">Select a session</option>
            </select>
            <button onclick="updateSessionSelect()" class="refresh-btn">
                <i class="ph ph-arrows-clockwise"></i> Refresh
            </button>
            <button onclick="reconnectSession()" class="reconnect-btn">
                <i class="ph ph-plug"></i> Reconnect
            </button>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="loadChats(document.getElementById('detailsSessionSelect').value)">
                <i class="ph ph-chats"></i> Chats
            </button>
            <button class="tab-btn" onclick="loadContacts(document.getElementById('detailsSessionSelect').value)">
                <i class="ph ph-address-book"></i> Contacts
            </button>
        </div>
        
        <!-- Chats Tab -->
        <div id="chatsTab" class="tab-content active">
         <!-- Add this where you want the chats to appear -->
<div id="chatsList"></div>
<div id="chatsPlaceholder"></div>

                <div id="chatsPlaceholder" class="placeholder">
                    <p>No chats available</p>
                </div>
            </div>
        </div>
        
        <!-- Contacts Tab -->
        <div id="contactsTab" class="tab-content">
            <div class="list-container">
                <div id="contactsList" class="items-list">
                    <!-- Contacts will be populated here -->
                </div>
                <div id="contactsPlaceholder" class="placeholder">
                    <p>No contacts available</p>
                </div>
            </div>
        </div>
    </div>
</div>




        <div class="section">
            <h2><i class="ph ph-chat-text"></i> Send Message</h2>
            <div class="form-group">
                <input type="text" id="jid" placeholder="Enter JID (phone@s.whatsapp.net)" value="554891854014@s.whatsapp.net">
                <textarea id="message" placeholder="Enter message" value="Hello!! world!!"></textarea>
                <button onclick="sendMessage()">Send Message</button>
            </div>
        </div>

        <div class="section">
            <h2><i class="ph ph-image"></i> Send Image</h2>
            <div class="form-group">
                <input type="text" id="imageJid" placeholder="Enter JID (phone@s.whatsapp.net)" value="554891854014@s.whatsapp.net">
                <input type="text" id="imageUrl" placeholder="Enter Image URL" value="http://209.145.62.86:3000/public/foto.jpeg">
                <input type="text" id="imageCaption" placeholder="Enter Caption (optional)" value="hello!">
                <div class="form-row">
                    <label for="viewonce">View Once:</label>
                    <select id="viewonce">
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>
                <button onclick="sendImage()">Send Image</button>
            </div>
        </div>

        <!-- Add this after the "Send Image" section -->
        <div class="section">
            <h2><i class="ph ph-video"></i> Send Video</h2>
            <div class="form-group">
                <input type="text" id="videoJid" placeholder="Enter JID (phone@s.whatsapp.net)" value="554891854014@s.whatsapp.net">
                <input type="text" id="videoUrl" placeholder="Enter Video URL" value="https://example.com/video.mp4">
                <input type="text" id="videoCaption" placeholder="Enter Caption (optional)" value="Check out this video!">
                <div class="form-row">
                    <label for="videoViewonce">View Once:</label>
                    <select id="videoViewonce">
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="gifPlayback">Play as GIF:</label>
                    <select id="gifPlayback">
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>
                <button onclick="sendVideo()">Send Video</button>
            </div>
        </div>

        <!-- Add this after the "Send Video" section -->
        <div class="section">
            <h2><i class="ph ph-microphone"></i> Send Voice Note</h2>
            <div class="form-group">
                <input type="text" id="audioJid" placeholder="Enter JID (phone@s.whatsapp.net)" value="554891854014@s.whatsapp.net">
                <input type="text" id="audioUrl" placeholder="Enter Audio URL" value="http://209.145.62.86:3000/public/oi.ogg">
                <div class="form-row">
                    <label for="audioDuration">Duration (seconds):</label>
                    <input type="number" id="audioDuration" placeholder="Duration in seconds" value="0" min="0">
                </div>
                <button onclick="sendVoiceNote()">Send Voice Note</button>
            </div>
        </div>
    </div>


<!-- 
    /* 
sample qr code data
{
    "status": "New connection created",
    "sessionId": "default",
    "qrCode": "2@isXQMr9qaNDhpdwWZFLM/PIY59/LtWY9ZKT3qI3I7eHp0ClGOhruQeHd+O6D5NWsVG8557IZQyFBHzL7zUm1HXoxAlTTgNnpKTk=,DokWTivKJqEJchkG36o/Pv+gkocM/FHJQWO694AWxnA=,5Uu0/qKzBRbEXpZhnQqSMXAFK0ipZwNfGOo3S7Hqfxg=,GAFNb8CcgXqKaVYO8sc8WlAdFLXC0XF0qEgXF4QUe7Q="
}

*/
        // Generate QR code if available
        if (data.qrCode) {
            // Using qrcode.js library
            new QRCode(document.getElementById(`qrcode-${sessionId}`), {
                text: data.qrCode,
                width: 256,
                height: 256
            }); -->

<!-- get list of blocked phones -->
 <div class="section" id="blockedPhones">
    <div class="col" >
        <h2><i class="ph ph-phone-slash"></i> Blocked Phones</h2>
        <div id="blockedPhonesList"></div>
    </div>
    <!-- refresh button -->
    <span hoverable id="refresh-blocked-phones" class="" onclick="getBlockedPhones()" style="cursor: pointer;">
        <i class="ph ph-arrows-clockwise"></i> Refresh
    </span> 
    <!-- integer input phone number -->
    <div class="form-group">
        <input type="text" id="blockedPhoneNumber" placeholder="Enter phone number">
        <button onclick="blockPhone()">Block Phone</button>
    </div>

    <!-- 
//POST route to block a user
app.post('/blockuser', (req, res) => {
    let userPhone = req.body.userPhone;

    //add to blockedUsers array
    blockedUsers.push(userPhone);

    //also add to violationTracker
    violationTracker.set(userPhone, { count: 0, lastViolation: Date.now() });

    //log blocked user
    console.log(`requestHandler.blockuser #1567: Blocking user ${userPhone}`);

    fs.appendFileSync(blockedUsersPath, `${userPhone}\n`);
    res.sendStatus(200);
});
 -->
</div>


 
    <div id="serverStatus" class="section">
        <div class="col" >
            <div class="resource">
                <div class="resource-name">RAM</div>
                <div class="resource-bar" id="ramBar" style="min-width: 200px;">
                    <div class="bar-fill"></div>
                    <div class="bar-text"></div>
                </div>
            </div>
            <div class="resource">
                <div class="resource-name">CPU</div>
                <div class="resource-bar" id="cpuBar" style="min-width: 200px;">
                    <div class="bar-fill"></div>
                    <div class="bar-text"></div>
                </div>
            </div>
            <div class="resource">
                <div class="resource-name">Disk</div>
                <div class="resource-bar" id="diskBar" style="min-width: 200px;">
                    <div class="bar-fill"></div>
                    <div class="bar-text"></div>
                </div>
            </div>
        </div>
        <span hoverable id="refresh-server-status" class="" onclick="getServerStatus()" style="cursor: pointer;">
            <i class="ph ph-arrows-clockwise"></i> Refresh Status
        </span>
        <!-- Added icon to check server status using Toasty notification -->
        <span id="check-server-status" style="cursor: pointer; margin-left: 10px; height: 10px; width: 10px;" onclick="checkServerStatusToast()">
            <i class="ph ph-server"></i>Status
        </span>
    </div>

</div>

</div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>

    <script src="script.js"></script> <!-- PUT CODE HERE: script.js is the main script that handles the websocket connection and the UI -->
 
</body>
</html> 